image: wukl/brufs-ci

stages:
  - test

test-debug:
  stage: test
  except:
    - schedules
  script:
    - mkdir build
    - cd build
    - cmake .. -DCMAKE_BUILD_TYPE=Debug -DBRUFS_SANITIZE=OFF
    - make -j8
    - brufscli/brufs version
    - libbrufs/test_all
    - brufscli/test
    - gcovr -sbr .. --exclude '.*catch.hpp$' --exclude '.*xxhash.*' --exclude '.*libbrufs/test.*' -o /dev/null

test-release:
  stage: test
  only:
    - schedules
  script:
    - mkdir build
    - cd build
    - cmake .. -DCMAKE_BUILD_TYPE=Release
    - make -j8
    - brufscli/brufs version
    - libbrufs/test_all
    - brufscli/test
